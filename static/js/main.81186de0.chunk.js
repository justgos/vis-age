(this["webpackJsonpvis-age"]=this["webpackJsonpvis-age"]||[]).push([[0],{41:function(e,t,a){e.exports=a(60)},46:function(e,t,a){},52:function(e,t,a){},59:function(e,t,a){},60:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(17),l=a.n(i),c=(a(46),a(4)),o=a(26),s=a.n(o),u=a(9),m=a(3),d=a(32),v=a(10),g=a(33),p=window.devicePixelRatio||1,f=a(6),h=(a(52),Object(u.b)((function(e){return Object(f.a)({},e.tooltip)}),{})((function(e){var t=e.active,a=e.x,n=e.y,i=e.content;return r.a.createElement("div",{className:"tooltip",style:{left:a,top:n,display:t?"block":"none"}},i)}))),b={updateTextFilter:function(e){return{type:"UPDATE_TEXT_FILTER",filter:e}}},E=Object(u.b)((function(e){return{textFilter:e.expressionDataset.textFilter}}),b)((function(e){var t=e.textFilter,a=e.updateTextFilter;return r.a.createElement("div",{className:"filter-panel"},r.a.createElement("input",{className:"text-filter",type:"text",placeholder:"filter by any text field",value:t,onChange:function(e){return a(e.target.value)}}))}));function x(e){var t=e.children,a=e.gestureData,i=Object(v.c)(),l=i.size,o=(l.width,l.height),s=i.camera,u=(i.gl,Object(n.useMemo)((function(){return[{value:0},{value:performance.now()},{value:performance.now()}]}),[])),d=Object(c.a)(u,3),g=d[0],p=d[1],f=d[2],h=Object(n.useRef)(),b=Object(n.useRef)(),E=Object(n.useMemo)((function(){return{x:0,y:-80,k:1}}),[]),x=Object(n.useMemo)((function(){return{dragging:!1,dragX:0,dragY:0,scrolling:!1,scrollX:0,scrollY:0,pinching:!1,pinchD:0,pinchA:0}}),[]);return Object(v.b)((function(){var e=performance.now();if(p.value=e,g.value++,e>f.value+1e3&&(f.value=e,g.value=0),a.dragging?(E.x-=(a.dragX-x.dragX)/E.k,E.y+=(a.dragY-x.dragY)/E.k,x.dragX=a.dragX,x.dragY=a.dragY):(x.dragX=0,x.dragY=0),x.dragging=a.dragging,a.scrolling?(E.k*=1-.002*(a.scrollY-x.scrollY),x.scrollX=a.scrollX,x.scrollY=a.scrollY):(x.scrollX=0,x.scrollY=0),x.scrolling=a.scrolling,a.pinching?(x.pinching&&(E.k*=a.pinchD/x.pinchD),x.pinchD=a.pinchD,x.pinchA=a.pinchA):x.pinching=!1,x.pinching=a.pinching,s.position.x=E.x,s.position.y=o/2+E.y,s.zoom=E.k,s.updateProjectionMatrix(),document.scrollingElement)document.scrollingElement.scrollTop})),r.a.createElement("scene",{ref:h},r.a.createElement("ambientLight",{intensity:.5}),r.a.createElement("directionalLight",{intensity:.6,position:[0,0,1e3],rotation:new m.Euler(0,0,0),castShadow:!0,ref:b}),t)}var w=a(38),O=a.n(w),j=a(39),y=a.n(j),T=a(13),D=a(40),_={lastUpdateTime:0,raw:[],textFilter:"",filtered:[]},N=function(e){return e.crossfilter&&e.textDimensions?(e.textDimensions.filterAll().filter((function(t){return!!t&&t.toLowerCase().includes(e.textFilter.toLowerCase())})),e.filtered=e.crossfilter.allFiltered(),e):e},A={active:!1,x:0,y:0,content:r.a.createElement(r.a.Fragment,null)},F=Object(T.b)({expressionDataset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UPDATE_DATASET":e.lastUpdateTime=Date.now(),e.raw=t.dataset;for(var a=0;a<e.raw.length;a++)e.raw[a].__id=a;return e.crossfilter=Object(D.a)(e.raw),e.textDimensions=e.crossfilter.dimension((function(e){return[e.gene,e.sex,e.tissue,e.subtissue,e.cell_ontology_class].join("|")})),e=N(e),Object(f.a)({},e);case"UPDATE_TEXT_FILTER":return e.textFilter=t.filter,e=N(e),Object(f.a)({},e);default:return e}},tooltip:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UPDATE_TOOLTIP":return e.x=t.x,e.y=t.y,e.content=t.content,e.active=!0,Object(f.a)({},e);case"HIDE_TOOLTIP":return e.active=!1,Object(f.a)({},e);default:return e}}}),X=Object(T.c)(F),Y=a(11),P=a(16),z=a(14),S=a(15),C=function(e){function t(e){var a;return Object(Y.a)(this,t),(a=Object(P.a)(this,Object(z.a)(t).call(this,{vertexShader:"\n        attribute float size;\n        attribute vec4 color;\n        varying vec4 vColor;\n\n        void main() {\n            vec4 mvPosition = modelViewMatrix * vec4( position.xyz, 1.0 );\n            gl_PointSize = 10.0 * size;\n            gl_Position = projectionMatrix * mvPosition;\n            vColor = color;\n            // if(size == 0.0)\n            //   color.w = 0.0;\n        }\n      ",fragmentShader:"\n        uniform sampler2D pointTexture;\n        varying vec4 vColor;\n        void main() {\n          gl_FragColor = vColor * texture2D(pointTexture, gl_PointCoord);\n          // gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n          // gl_FragColor.w *= 0.4;\n        }\n      ",blending:m.NormalBlending,depthTest:!1,transparent:!0}))).uniforms={pointTexture:{value:e.pointTexture}},a}return Object(S.a)(t,e),t}(m.ShaderMaterial),M=function(){var e=Object(v.c)(),t=e.mouse,a=e.camera,i=e.size,l=i.width,o=i.height,s=Object(n.useState)(Object(f.a)({},X.getState().expressionDataset)),u=Object(c.a)(s,2),d=u[0],g=u[1],p=function(){g(Object(f.a)({},X.getState().expressionDataset))};Object(n.useEffect)((function(){X.subscribe((function(){p()})),p()}),[]);var h=function(e){return 25*e.fold_change_log2},b=function(e){return.9*-Math.log(Math.max(e.p_value,1e-300))},E=Object(n.useRef)(),x=Object(n.useRef)(),w=Object(n.useMemo)((function(){console.log("expressionDataset.raw.length",d.raw.length);for(var e=[],t=0;t<3*d.raw.length;t+=3){var a=d.raw[t/3];e.push(h(a),b(a),0)}for(var n=[],r=0;r<d.raw.length;r+=1)n.push(1);for(var i=[],l=[251/255,101/255,66/255],c=[55/255,94/255,151/255],o=0;o<4*d.raw.length;o+=4){d.raw[o/4].fold_change_log2>0?i.push.apply(i,l.concat([1])):i.push.apply(i,c.concat([1]))}return[new Float32Array(e),new Float32Array(n),new Float32Array(i),new O.a]}),[d.lastUpdateTime,d.raw]),j=Object(c.a)(w,4),T=j[0],D=j[1],_=j[2],N=j[3];Object(n.useEffect)((function(){if(x.current){for(var e=[],t=0;t<d.raw.length;t+=1)e.push(.2);for(var a=0;a<d.filtered.length;a+=1){e[d.filtered[a].__id]=1}x.current.array=new Float32Array(e),x.current.needsUpdate=!0,N.clear(),N.load(d.filtered.map((function(e){return Object(f.a)({minX:h(e)-1,minY:b(e)-1,maxX:h(e)+1,maxY:b(e)+1},e)})))}}),[d.filtered]);var A=Object(n.useMemo)((function(){var e=new m.TextureLoader;return[new C({pointTexture:e.load("/textures/circle.png")})]}),[]),F=Object(c.a)(A,1)[0],Y=Object(n.useMemo)((function(){return{value:0}}),[]),P=function(e){return e&&""!==e&&"nan"!==e?e:"\u2014"};return Object(v.b)((function(){var e,n,i,c=.5*t.x*l/a.zoom+a.position.x,s=.5*t.y*o/a.zoom+a.position.y,u=y()(N,c,s,1);if(u.length>0){var m=u[0];m.__id!==Y.value&&(X.dispatch((e=((m.maxX+m.minX)/2-a.position.x)*a.zoom+l/2,n=o/2-((m.minY+m.maxY)/2-a.position.y)*a.zoom,i=r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"Gene"),r.a.createElement("div",{className:"value"},r.a.createElement("div",{className:"gene-name"},m.gene))),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"Fold-change"),r.a.createElement("div",{className:"value"},m.fold_change_log2.toFixed(2))),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"p-value"),r.a.createElement("div",{className:"value"},m.p_value.toExponential(6))),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"Sex"),r.a.createElement("div",{className:"value"},m.sex)),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"Tissue"),r.a.createElement("div",{className:"value"},P(m.tissue))),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"Subtissue"),r.a.createElement("div",{className:"value"},P(m.subtissue))),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"Cell type"),r.a.createElement("div",{className:"value"},P(m.cell_ontology_class)))),{type:"UPDATE_TOOLTIP",x:e,y:n,content:i})),Y.value=m.__id)}})),T.length<1?r.a.createElement(r.a.Fragment,null):r.a.createElement(r.a.Fragment,null,r.a.createElement("points",{frustumCulled:!1,material:F},r.a.createElement("bufferGeometry",{attach:"geometry"},r.a.createElement("bufferAttribute",{attachObject:["attributes","position"],count:T.length/3,array:T,itemSize:3,ref:E}),r.a.createElement("bufferAttribute",{attachObject:["attributes","size"],count:D.length,array:D,itemSize:1,ref:x}),r.a.createElement("bufferAttribute",{attachObject:["attributes","color"],count:_.length/4,array:_,itemSize:4}))))},k=(a(59),{updateDataset:function(e){return{type:"UPDATE_DATASET",dataset:e}}});var L=Object(u.b)(null,k)((function(e){var t=e.updateDataset;Object(n.useEffect)((function(){!function(){var e;s.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,s.a.awrap(new Promise((function(e,t){d.parse("/data/merged.csv",{delimiter:",",header:!0,download:!0,dynamicTyping:!0,complete:e,error:t})})));case 2:e=a.sent,t&&t(e.data);case 4:case"end":return a.stop()}}))}()}),[]);var a=Object(n.useRef)(null),i={dragging:!1,dragX:0,dragY:0,scrolling:!1,scrollX:0,scrollY:0,pinching:!1,pinchD:0,pinchA:0},l=Object(g.a)({onDrag:function(e){var t=e.event,a=e.last,n=e.down,r=Object(c.a)(e.movement,2),l=r[0],o=r[1];i.dragging=n,i.dragX=l,i.dragY=o,a||null===t||void 0===t||t.preventDefault()},onWheel:function(e){var t=e.event,a=e.last,n=(e.down,Object(c.a)(e.xy,2)),r=n[0],l=n[1];i.scrolling=0!==r||0!==l,i.scrollX=r,i.scrollY=l,a||null===t||void 0===t||t.preventDefault()},onPinch:function(e){var t=e.event,a=e.last,n=e.down,r=Object(c.a)(e.da,2),l=r[0],o=r[1];i.pinching=n,i.pinchD=l,i.pinchA=o,a||null===t||void 0===t||t.preventDefault()}},{domTarget:a,event:{passive:!1}});return r.a.useEffect((function(){l()}),[l]),r.a.createElement("div",{className:"App"},r.a.createElement(h,null),r.a.createElement(E,null),r.a.createElement("div",{className:"main-canvas",ref:a},r.a.createElement(v.a,{camera:{fov:75,near:1,far:1e4,position:[0,0,1e3],rotation:new m.Euler(0,0,0)},orthographic:!0,pixelRatio:p},r.a.createElement(x,{gestureData:i},r.a.createElement(M,null)))))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(u.a,{store:X},r.a.createElement(L,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[41,1,2]]]);
//# sourceMappingURL=main.81186de0.chunk.js.map