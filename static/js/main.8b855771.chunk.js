(this["webpackJsonpvis-age"]=this["webpackJsonpvis-age"]||[]).push([[0],{170:function(e,t,n){e.exports=n(244)},175:function(e,t,n){},213:function(e,t,n){},238:function(e,t,n){},239:function(e,t,n){},244:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(15),i=n.n(o),s=(n(175),n(17)),l=n.n(s),c=n(3),u=n(30),d=n(38),f=n.n(d),m=n(4),v=n(101),p=n(27),g=window.devicePixelRatio||1,b=n(102),E=n.n(b),h=function(){var e,t;return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l.a.awrap(f.a.get("./proto/visage.proto"));case 2:return e=n.sent,t=E.a.parse(e.data).root,n.abrupt("return",t);case 5:case"end":return n.stop()}}))},y=function(e,t){var n,a,r;return l.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,l.a.awrap(h());case 2:return n=o.sent,o.next=5,l.a.awrap(f.a.get(t,{responseType:"arraybuffer"}));case 5:return a=o.sent,r=n[e].decode(new Uint8Array(a.data)),o.abrupt("return",r);case 8:case"end":return o.stop()}}))},w="SET_EXPRESSION_DATASET_FILTER_VALUE",x=function(e,t){return{type:w,name:e,value:t}},O=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{type:"UPDATE_DATASET",id:e,dataset:t,meta:n}},_=n(8),j=n(250),N=n(2),S=(n(213),{setFilterValue:x,updateDataset:O}),M=Object(u.b)((function(e){var t;return{filterValues:e.expressionDataset.filterValues,filterValueVocabulary:e.expressionDataset.filterValueVocabulary,cellMetaMetadata:null===(t=e.datasets.cellMetadata)||void 0===t?void 0:t.meta}}),S),D={start_age:"Start age",end_age:"End age",sex:"Sex",tissue:"Tissue",subtissue:"Subtissue",cell_ontology_class:"Cell type"};var T=M((function(e){var t=e.mode,n=e.setMode,o=e.filterValues,i=e.filterValueVocabulary,s=e.cellMetaMetadata,u=e.setFilterValue,d=e.updateDataset,f=Object(a.useState)(-1),m=Object(c.a)(f,2),v=m[0],p=m[1];return r.a.createElement("div",{className:"filter-panel"},r.a.createElement("div",{className:"project-description"},r.a.createElement("h3",null,"Visual exploration of the ",r.a.createElement("a",{href:"https://github.com/czbiohub/tabula-muris-senis"},"Tabula Muris Senis")," dataset"),r.a.createElement("p",null,"Detailed project description and the data preparation code can be found ",r.a.createElement("a",{href:"https://github.com/justgos/indagatio-muris-senis"},"here")),r.a.createElement("div",{className:"mode-label"},"View mode"),r.a.createElement(j.b,{value:t,options:[{label:"Pathways",value:"pathways"},{label:"Embedding",value:"embeddings"}],onChange:function(e){return n(e.target.value)},className:"bp3-fill mode-select"}),"pathways"===t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Fold-changes in expression of various genes overlaid over the reaction network, vertically aligned by the cellular location: nucleus -> extracellular region")),"embeddings"===t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"UMAP embedding of cells by their gene expression, soft-filterable by the cellular processes which the most-expressed genes are associated with"))),"pathways"===t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{className:"filter-element text-filter ".concat(N.a.INPUT," ").concat(N.a.MINIMAL),type:"text",placeholder:"filter by any text field",value:o.get("text")||"",onChange:function(e){return u("text",e.currentTarget.value)}}),r.a.createElement(j.a,{className:"filter-element homolog-filter ".concat(N.a.MINIMAL),checked:null!=o.get("uniprot_daphnia"),onChange:function(e){return u("uniprot_daphnia",e.currentTarget.checked?"~":void 0)}},"has Daphnia homolog")),"embeddings"===t&&s&&r.a.createElement("div",{className:"filter-element"},r.a.createElement("div",{className:"filter-element-label"},"GO activities"),r.a.createElement(j.d,{className:"".concat(N.a.MINIMAL),selectedValue:v,onChange:function(e){return function(e){var t;return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(p(e),!(e>=0)){n.next=8;break}return n.next=4,l.a.awrap(y("Activity","./data/go-activity/"+e+".bin"));case 4:t=n.sent,null===d||void 0===d||d("goActivity",t.values),n.next=9;break;case 8:null===d||void 0===d||d("goActivity",[]);case 9:case"end":return n.stop()}}))}(parseInt(e.currentTarget.value))}},r.a.createElement(j.c,{value:-1},"<none>"),s.goActivities.map((function(e,t){return r.a.createElement(j.c,{key:t,value:t},e)})))),"pathways"===t&&["start_age","end_age","sex","tissue","subtissue","cell_ontology_class"].map((function(e){var t;return r.a.createElement("div",{key:e,className:"filter-element"},r.a.createElement("div",{className:"filter-element-label"},D[e]),r.a.createElement(j.d,{className:"".concat(N.a.MINIMAL),selectedValue:o.get(e),onChange:function(t){return u(e,t.currentTarget.value)}},Object(_.a)((null===(t=i.get(e))||void 0===t?void 0:t.entries())||[]).map((function(e){return r.a.createElement(j.c,{key:e[0],value:e[0]},""!==e[0]?e[0]:"<none>",r.a.createElement("span",{className:"count"},e[1]))}))))})))})),A=n(50);function F(e){var t=e.children,n=e.canvasContainerRef,o=Object(p.c)(),i=o.mouse,s=o.size,l=s.width,u=s.height,d=o.camera,f=o.invalidate,v=Object(a.useMemo)((function(){return[{value:0},{value:performance.now()},{value:performance.now()}]}),[]),g=Object(c.a)(v,3),b=g[0],E=g[1],h=g[2],y=Object(a.useRef)(),w=Object(a.useRef)(),x=Object(a.useMemo)((function(){return[new m.Vector3,{x:0,y:0,z:0,k:.25,vec:new m.Vector3,spherical:new m.Spherical}]}),[]),O=Object(c.a)(x,2),_=(O[0],O[1]);var j=Object(A.a)({onDrag:function(e){var t=e.event,n=e.last,a=e.down,r=Object(c.a)(e.delta,2),o=r[0],i=r[1],s=e.buttons,l=e.touches;!a||1!==s&&1!==l||(_.x-=o/_.k,_.y+=i/_.k,f()),n||null===t||void 0===t||t.preventDefault(),a&&f()},onWheel:function(e){var t=e.event,n=e.last,a=Object(c.a)(e.delta,2),r=a[0],o=a[1];if(0!==r||0!==o){var s=[.5*i.x*l/d.zoom+d.position.x,.5*i.y*u/d.zoom+d.position.y],m=Object(c.a)(s,2),v=m[0],p=m[1],g=1-.002*o;_.x+=(v-_.x)*-(1-g),_.y+=(p-_.y)*-(1-g),_.k*=g,f()}n||null===t||void 0===t||t.preventDefault()},onPinch:function(e){var t,n,a=e.event,r=e.first,o=e.last,i=e.down,s=Object(c.a)(e.da,2),f=s[0],m=(s[1],Object(c.a)(e.previous,2)),v=m[0],p=(m[1],e.origin),g=e.memo;if(i&&!r){var b=f/v;_.x+=(g[0]-_.x)*-(1-b),_.y+=(g[1]-_.y)*-(1-b),_.k*=b}return o||null===a||void 0===a||a.preventDefault(),r?(t=(null===p||void 0===p?void 0:p[0])||0,n=(null===p||void 0===p?void 0:p[1])||0,[(t-.5*l)/d.zoom+d.position.x,(u-n-.5*u)/d.zoom+d.position.y]):g}},{domTarget:n,event:{passive:!1}});return Object(a.useEffect)((function(){j()}),[j]),Object(p.b)((function(){var e=performance.now();E.value=e,b.value++,e>h.value+1e3&&(h.value=e,b.value=0),d.position.x=_.x,d.position.y=_.y,d.zoom=_.k,d.updateProjectionMatrix()})),r.a.createElement("scene",{ref:y},r.a.createElement("ambientLight",{intensity:.5}),r.a.createElement("directionalLight",{intensity:.6,position:[0,0,1e3],rotation:new m.Euler(0,0,0),castShadow:!0,ref:w}),t)}n(238);var V=n(6),I=n(42),P=n(51),C={raw:[],filteredGeneExpression:new Map,filterValues:new Map,filterValueVocabulary:new Map,filterDimensionNames:[],customFilterFunctions:new Map,filtered:[],raw2filtered:new Map},R=function(e){return e.filterDimensionNames.forEach((function(t){var n,a=null===(n=e.filterDimensions)||void 0===n?void 0:n.get(t);if(a){var r=a.group().reduceCount().all().slice().sort((function(e,t){return e.key.localeCompare(t.key,"en",{numeric:!0})}));e.filterValueVocabulary.set(t,new Map(r.map((function(e){return[e.key,e.value]}))))}})),e},k=function(e){if(!e.crossfilter||!e.filterDimensions)return e;var t=!0,n=!1,a=void 0;try{for(var r,o=e.filterDimensions.entries()[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var i=r.value,s=Object(c.a)(i,2),l=s[0],u=s[1];u.filterAll();var d=e.filterValues.get(l);if(null!=d){var f=e.customFilterFunctions.get(l);f?u.filterFunction(f(d)):u.filter(d)}}}catch(p){n=!0,a=p}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}e.filtered=e.crossfilter.allFiltered(),e.raw2filtered.clear(),e.filtered.forEach((function(t,n){return e.raw2filtered.set(t.__id||-1,n)})),e.filteredGeneExpression=new Map;for(var m=0;m<e.filtered.length;m++){var v=e.filtered[m];v.gene&&e.filteredGeneExpression.set(v.gene,v)}return e=R(e)},z={},L=function(e){return e.filterDimensionNames.forEach((function(t){var n,a=null===(n=e.filterDimensions)||void 0===n?void 0:n.get(t);if(a){var r=a.group().reduceCount().all().slice().sort((function(e,t){return e.key.localeCompare(t.key,"en",{numeric:!0})}));e.filterValueVocabulary.set(t,new Map(r.map((function(e){return[e.key,e.value]}))))}})),e},U=function(e){if(!e.crossfilter||!e.filterDimensions)return e;var t=!0,n=!1,a=void 0;try{for(var r,o=e.filterDimensions.entries()[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var i=r.value,s=Object(c.a)(i,2),l=s[0],u=s[1];u.filterAll();var d=e.filterValues.get(l);if(null!=d){var f=e.customFilterFunctions.get(l);f?u.filterFunction(f(d)):u.filter(d)}}}catch(m){n=!0,a=m}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}return e.filtered=e.crossfilter.allFiltered(),e.raw2filtered.clear(),e.filtered.forEach((function(t,n){return e.raw2filtered.set(t.__id||-1,n)})),e},G=n(53),X=function(e,t){var n=[],a=[],r=new Map;e.forEach((function(e){return function(e){var t=Object(V.a)({},e,{location:0,x:1e3*(Math.random()-.5),y:1e3*(Math.random()-.5),vx:0,vy:0});if("molecule"===e.type&&e.cellularLocation){var a=e.cellularLocation;["extracellular region","external side of plasma membrane","cell junction"].some((function(e){return null===a||void 0===a?void 0:a.includes(e)}))?t.location=5:["cell outer membrane","cell wall","cell membrane","cytoplasmic side of plasma membrane","plasma membrane"].some((function(e){return null===a||void 0===a?void 0:a.includes(e)}))?t.location=4:["mitochondrial"].some((function(e){return null===a||void 0===a?void 0:a.includes(e)}))?t.location=3:["cytosol","host cell cytosol"].some((function(e){return null===a||void 0===a?void 0:a.includes(e)}))?t.location=0:["golgi"].some((function(e){return null===a||void 0===a?void 0:a.includes(e)}))?t.location=-3:["endoplasmic reticulum"].some((function(e){return null===a||void 0===a?void 0:a.includes(e)}))?t.location=-4:["nuclear envelope","nucleoplasm","nucleus","nucleolus","nuclear","chromosome","chromosome, centromeric region"].some((function(e){return null===a||void 0===a?void 0:a.includes(e)}))&&(t.location=-5)}n.push(t)}(e)})),t.forEach((function(e){return function(e){var t=Object(V.a)({},e),n=r.get(e.source);n||(n=[],r.set(e.source,n)),n.push(t);var o=r.get(e.target);o||(o=[],r.set(e.target,o)),o.push(t),a.push(t)}(Object(V.a)({},e,{sourcePos:[0,0],targetPos:[0,0]}))}));for(var o=function(e){var t=n[e];if("reaction"===t.type||"control"===t.type||"template_reaction"===t.type){var a=r.get(t.__id);if(a&&a.length>0){var o=a.map((function(e){return n[e.source===t.__id?e.target:e.source].location})).reduce((function(e,t){return e+t}),0)/a.length;t.location=o}}},i=0;i<n.length;i++)o(i);var s=Object(G.c)(n),l=JSON.parse(JSON.stringify(Array.from(r).map((function(e){return e[1]}))));s.force("charge",Object(G.b)().strength(-30)).force("link",Object(G.a)(l.reduce((function(e,t){return[].concat(Object(_.a)(e),Object(_.a)(t))}),[])).distance((function(e){return Math.max(250*Math.abs(e.target.location-e.source.location),10)}))).force("center",Y(0,0,(function(e){}),(function(e){return null!=e.location?250*e.location:void 0}))),s.stop();var c=s.nodes(),u=[];return u.length===c.length?s.nodes().forEach((function(e,t){e.x=u[t].x,e.y=u[t].y})):(s.tick(50),u=c.map((function(e){return{x:e.x,y:e.y}}))),s.nodes().forEach((function(e,t){n[t].x=e.x,n[t].y=e.y,n[t].minX=e.x,n[t].maxX=e.x,n[t].minY=e.y,n[t].maxY=e.y})),a.forEach((function(e){e.sourcePos=[n[e.source].x,n[e.source].y],e.targetPos=[n[e.target].x,n[e.target].y]})),{nodes:n,edges:a,edgeMap:r}},B=function(e){var t={nodes:JSON.parse(JSON.stringify(e.nodes)),edges:[],edgeMap:new Map};return t.nodes.forEach((function(e){e.vx=0,e.vy=0,e.minX=e.x,e.maxX=e.x,e.minY=e.y,e.maxY=e.y})),e.edges.forEach((function(e){var n={source:e[0],target:e[1],relation:e[2],sourcePos:[0,0],targetPos:[0,0]};n.sourcePos=[t.nodes[n.source].x,t.nodes[n.source].y],n.targetPos=[t.nodes[n.target].x,t.nodes[n.target].y];var a=t.edgeMap.get(n.source);a||(a=[],t.edgeMap.set(n.source,a)),a.push(n);var r=t.edgeMap.get(n.target);r||(r=[],t.edgeMap.set(n.target,r)),r.push(n)})),t},Y=function(e,t,n,a){var r,o,i,s,l=function(e){return function(){return e}},c=function(e){return 0===e.location?.2:5};function u(n){var a,l,c=r.length,u=0,d=0;for(a=0;a<c;++a)u+=(l=r[a]).x,d+=l.y;for(u=u/c-e,d=d/c-t,a=0;a<c;++a)l=r[a];for(var f=0,m=r.length;f<m;++f)l=r[f],null!=i[f]&&l.vx&&(l.vx+=(i[f]-l.x)*o[f]*n),null!=s[f]&&l.vy&&(l.vy+=(s[f]-l.y)*o[f]*n)}function d(){if(r){var e,t=r.length;for(o=new Array(t),i=new Array(t),s=new Array(t),e=0;e<t;++e)i[e]=n(r[e],e,r),s[e]=a(r[e],e,r),o[e]=+c(r[e])}}return u.initialize=function(e){r=e,d()},u.strength=function(e){return arguments.length?(c="function"===typeof e?e:l(+e),d(),u):c},u.x=function(e){return arguments.length?(n="function"===typeof e?e:l(+e),d(),u):n},u.y=function(e){return arguments.length?(a="function"===typeof e?e:l(+e),d(),u):a},u},J={raw:{nodes:[],edges:[]},graph:{nodes:[],edges:[],edgeMap:new Map},geneAnnotations:{genes:new Map}},W=function(e){return e.graph=X(e.raw.nodes.map((function(e){return e})),e.raw.edges.map((function(e){return{source:e[0],target:e[1],relation:e[2]}}))),e},H={active:!1,x:0,y:0,content:r.a.createElement(r.a.Fragment,null)},q={targets:new Map,selectedNodes:[],selectedEdges:[]},$=Object(I.b)({expressionDataset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UPDATE_EXPRESSION_DATASET":e.raw=t.dataset;for(var n=0;n<e.raw.length;n++){var a=e.raw[n];a.__id=n}return Object(V.a)({},e);case"SET_EXPRESSION_DATASET_FILTER_DIMENSIONS":var r=t;return e.crossfilter=Object(P.a)(e.raw),e.filterDimensions=new Map,e.filterDimensionNames=r.dimensions,e.filterDimensionNames.forEach((function(t){e.crossfilter&&e.filterDimensions&&e.filterDimensions.set(t,e.crossfilter.dimension((function(e){return e[t]||""})))})),e.filterValues=new Map,(e=R(e)).filterDimensionNames.forEach((function(t){var n;e.filterValues.set(t,(null===(n=e.filterValueVocabulary.get(t))||void 0===n?void 0:n.entries().next().value[0])||"")})),e=k(e),Object(V.a)({},e);case"ADD_EXPRESSION_DATASET_CUSTOM_FILTER_DIMENSION":var o=t;return e.filterDimensions&&e.crossfilter?(e.filterDimensions.set(o.name,e.crossfilter.dimension(o.selector)),o.filterFn&&e.customFilterFunctions.set(o.name,o.filterFn),e=k(e),Object(V.a)({},e)):(console.error("Trying to add a custom filter dimension before SET_FILTER_DIMENSIONS was called"),e);case w:var i=t;return e.filterValues.set(i.name,i.value),e.filterValues=new Map(e.filterValues),e=k(e),Object(V.a)({},e);default:return e}},datasets:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UPDATE_DATASET":var n=t;return e[n.id]={raw:n.dataset,meta:n.meta,filterValues:new Map,filterValueVocabulary:new Map,filterDimensionNames:[],customFilterFunctions:new Map,filtered:[],raw2filtered:new Map},Object(V.a)({},e);case"SET_FILTER_DIMENSIONS":var a=t,r=e[a.id];return r.crossfilter=Object(P.a)(r.raw),r.filterDimensions=new Map,r.filterDimensionNames=a.dimensions,r.filterDimensionNames.forEach((function(e){r.crossfilter&&r.filterDimensions&&r.filterDimensions.set(e,r.crossfilter.dimension((function(t){return t[e]||""})))})),r.filterValues=new Map,r.filterValueVocabulary=new Map,r=L(r),r=U(r),e[a.id]=r,Object(V.a)({},e);case"ADD_CUSTOM_FILTER_DIMENSION":var o=t,i=e[o.id];return i.filterDimensions&&i.crossfilter?(i.filterDimensions.set(o.name,i.crossfilter.dimension(o.selector)),o.filterFn&&i.customFilterFunctions.set(o.name,o.filterFn),i=U(i),e[o.id]=i,Object(V.a)({},e)):(console.error("Trying to add a custom filter dimension before SET_FILTER_DIMENSIONS was called"),e);case"SET_FILTER_VALUE":var s=t,l=e[s.id];return l.filterValues.set(s.name,s.value),l.filterValues=new Map(l.filterValues),l=U(l),e[s.id]=l,Object(V.a)({},e);default:return e}},pathways:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UPDATE_PATHWAYS":var n=t;return n.pathways.dehydrated?e.graph=B(n.pathways):(e.raw=n.pathways,e=W(e)),Object(V.a)({},e);case"UPDATE_GENE_ANNOTATIONS":var a=t;return e.geneAnnotations={genes:new Map},a.geneAnnotations.forEach((function(t){return e.geneAnnotations.genes.set(t.name,t)})),Object(V.a)({},e);case"UPDATE_FILTER":return Object(V.a)({},e);default:return e}},tooltip:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UPDATE_TOOLTIP":return e.x=t.x,e.y=t.y,e.content=t.content,e.active=!0,Object(V.a)({},e);case"HIDE_TOOLTIP":return e.active=!1,Object(V.a)({},e);default:return e}},selection:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UPDATE_TARGET":var n=t;return e.targets.set(n.id,{points:n.points,ctx:n.ctx,tooltipConstructor:n.tooltipConstructor}),e.targets=new Map(e.targets),Object(V.a)({},e);case"UPDATE_SELECTION":return e.selectedNodes=t.selectedNodes,e.selectedEdges=t.selectedEdges,Object(V.a)({},e);default:return e}}}),K=Object(I.c)($),Q=n(22),Z=n(28),ee=n(25),te=n(26),ne=function(e){function t(){var e;return Object(Q.a)(this,t),(e=Object(Z.a)(this,Object(ee.a)(t).call(this,{vertexShader:"\n        // attribute vec2 uv;\n        varying vec2 texcoord;\n        attribute vec4 color;\n        varying vec4 vColor;\n\n        void main() {\n            vec4 mvPosition = modelViewMatrix * vec4( position.xyz, 1.0 );\n            gl_Position = projectionMatrix * mvPosition;\n            texcoord = uv;\n            vColor = color;\n        }\n      ",fragmentShader:"\n        varying vec2 texcoord;\n        varying vec4 vColor;\n        void main() {\n          gl_FragColor = vColor;\n          gl_FragColor.w *= (1.0 - pow(texcoord.x, 4.0));\n          // gl_FragColor.w *= 0.2;\n        }\n      ",blendSrc:m.SrcAlphaFactor,blendDst:m.OneMinusSrcAlphaFactor,blending:m.CustomBlending,transparent:!0}))).uniforms={map:{value:null}},e}return Object(te.a)(t,e),t}(m.ShaderMaterial);var ae=function(e){var t=e.edges,n=e.color,o=Object(a.useMemo)((function(){var e=[],a=[],r=[];return t.forEach((function(t){return o=t,e.push(o.sourcePos[0],o.sourcePos[1],0,o.targetPos[0],o.targetPos[1],0),a.push(0,0,1,1),r.push.apply(r,Object(_.a)(n)),void r.push.apply(r,Object(_.a)(n));var o})),[new m.BufferAttribute(new Float32Array(e),3),new m.BufferAttribute(new Float32Array(a),2),new m.BufferAttribute(new Float32Array(r),4)]}),[t]),i=Object(c.a)(o,3),s=i[0],l=i[1],u=i[2],d=Object(a.useMemo)((function(){return[new ne]}),[]),f=Object(c.a)(d,1)[0];return r.a.createElement("lineSegments",{frustumCulled:!1,material:f},r.a.createElement("bufferGeometry",{attach:"geometry",attributes:{position:s,uv:l,color:u}}))},re=n(110),oe=function(e,t){return function(n){function a(e){var t;return Object(Q.a)(this,a),(t=Object(Z.a)(this,Object(ee.a)(a).call(this,e))).subscription=function(){},t._mounted=!1,t.state={selection:{targets:new Map,selectedNodes:[],selectedEdges:[]}},t}return Object(te.a)(a,n),Object(re.a)(a,[{key:"handleStoreUpdate",value:function(){this._mounted&&this.setState({selection:Object(V.a)({},K.getState().selection)})}},{key:"componentDidMount",value:function(){this._mounted=!0,this.subscription=K.subscribe(this.handleStoreUpdate.bind(this)),this.handleStoreUpdate()}},{key:"componentWillUnmount",value:function(){this._mounted=!1,this.subscription()}},{key:"render",value:function(){var n=t(this.state.selection,this.props);return r.a.createElement(e,n)}}]),a}(r.a.Component)},ie=function(e){function t(e){var n;return Object(Q.a)(this,t),(n=Object(Z.a)(this,Object(ee.a)(t).call(this,{vertexShader:"\n        attribute float size;\n        attribute vec4 color;\n        varying vec4 vColor;\n\n        void main() {\n            vec4 mvPosition = modelViewMatrix * vec4( position.xyz, 1.0 );\n            float projectionSize = abs((projectionMatrix[0][0] + projectionMatrix[1][1]) / 2.0 * 300.0);\n            gl_PointSize = 1.0 * size * pow(projectionSize, 0.3);\n            // gl_PointSize = 1.0 * size;\n            gl_Position = projectionMatrix * mvPosition;\n            vColor = color;\n            // if(size == 0.0)\n            //   color.w = 0.0;\n        }\n      ",fragmentShader:"\n        uniform sampler2D pointTexture;\n        varying vec4 vColor;\n        void main() {\n          gl_FragColor = vColor * texture2D(pointTexture, gl_PointCoord);\n          // gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n          // gl_FragColor.w *= 0.4;\n        }\n      ",blending:m.NormalBlending,transparent:!0}))).uniforms={pointTexture:{value:e.pointTexture}},n}return Object(te.a)(t,e),t}(m.ShaderMaterial);var se=function(e){var t=e.nodes,n=e.sizes,o=e.colors,i=Object(a.useMemo)((function(){var e=[];return t.forEach((function(t){return n=t,void e.push(n.x,n.y,n.z||0);var n})),[new m.BufferAttribute(new Float32Array(e),3)]}),[t]),s=Object(c.a)(i,1)[0],l=Object(a.useMemo)((function(){return[new m.BufferAttribute(new Float32Array(n),1),new m.BufferAttribute(new Float32Array(o),4)]}),[n,o]),u=Object(c.a)(l,2),d=u[0],f=u[1],v=Object(a.useMemo)((function(){var e=new m.TextureLoader;return[new ie({pointTexture:e.load("./textures/circle.png")})]}),[]),p=Object(c.a)(v,1)[0];return t.length<1?r.a.createElement(r.a.Fragment,null):r.a.createElement("points",{frustumCulled:!1,material:p},r.a.createElement("bufferGeometry",{attach:"geometry",attributes:{position:s,size:d,color:f}}))},le=function(e,t,n,a){return{type:"UPDATE_TARGET",id:e,points:t,ctx:n,tooltipConstructor:a}},ce=function(e,t){return{type:"UPDATE_SELECTION",selectedNodes:e,selectedEdges:t}},ue=function(e){var t=e.nodes,n=e.edges,o=Object(p.c)(),i=[0,0,0,.1],s=[251/255,101/255,66/255,.4],l=[55/255,94/255,151/255,.4],u=Object(a.useState)(K.getState().expressionDataset.filteredGeneExpression),d=Object(c.a)(u,2),f=d[0],m=d[1],v=function(){m(K.getState().expressionDataset.filteredGeneExpression)};function g(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=[],a=[],r=[],o=new Map,c=0;c<e.length;c++){var u=e[c],d=!1,m=-1,v=i,p=10;if("molecule"===u.type){var g,b,E=null===(g=u.entityReference)||void 0===g?void 0:null===(b=g.gene)||void 0===b?void 0:b.name;if(E){var h=f.get(E);if(null!=h){d=!0,m=h.__id||-1;var y=h.fold_change_log2||0;p=2*Math.sqrt(Math.abs(y))*13,v=y>0?s:l}}}t&&((v=v.slice())[3]=5),d&&r.push(e[c]),o.set(u.__id,m),n.push.apply(n,Object(_.a)(v)),a.push(p)}return{colors:n,sizes:a,filteredNodes:r,refExpressionRows:o}}Object(a.useEffect)((function(){var e=K.subscribe((function(){v()}));return v(),e}),[]);var b=Object(a.useMemo)((function(){return g(t)}),[t,f]),E=b.colors,h=b.sizes,y=b.filteredNodes,w=b.refExpressionRows,x=function(e,t,n,a){var o=0,i=[];if(null==e)return i.push(r.a.createElement("div",{key:0},"\u2014")),i;for(;o<e.length&&o<n;)i.push(t(e[o],o)),o++;if(o<e.length){var s=r.a.createElement("div",{className:"list-truncation-notice",key:o+1},e.length-o," more..");a&&(s=a(s,o+1)),i.push(s)}return i};Object(a.useEffect)((function(){K.dispatch(le("primary",y,o,(function(e){var t,n,a,o,i,s,l,c,u=K.getState().pathways.graph,d=u.nodes[e],f=w.get(d.__id),m=f&&f>=0?K.getState().expressionDataset.raw[f]:void 0,v=Array.from(new Set((u.edgeMap.get(d.__id)||[]).map((function(e){return{node:u.nodes[e.source===d.__id?e.target:e.source],relation:e.relation}})))),p=v.map((function(e){return u.edgeMap.get(e.node.__id)||[]})).reduce((function(e,t){return[].concat(Object(_.a)(e),Object(_.a)(t))}),[]),g={};p.forEach((function(e){g[e.source]=u.nodes[e.source],g[e.target]=u.nodes[e.target]})),K.dispatch(ce(Object.values(g),p));var b=null===(t=d.entityReference)||void 0===t?void 0:null===(n=t.gene)||void 0===n?void 0:n.name,E=void 0;return b&&(E=K.getState().pathways.geneAnnotations.genes.get(b)),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"Name"),r.a.createElement("div",{className:"value"},b||d.name)),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"Location"),r.a.createElement("div",{className:"value"},d.cellularLocation)),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"log",r.a.createElement("sub",null,"2"),"(Fold-change)"),r.a.createElement("div",{className:"value",style:{color:((null===m||void 0===m?void 0:m.fold_change_log2)||0)>0?"#fb6542":"#375e97"}},null===m||void 0===m?void 0:null===(a=m.fold_change_log2)||void 0===a?void 0:a.toFixed(2))),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"xref"),r.a.createElement("div",{className:"value"},null===(o=d.entityReference)||void 0===o?void 0:null===(i=o.xref)||void 0===i?void 0:i.db,":",null===(s=d.entityReference)||void 0===s?void 0:null===(l=s.xref)||void 0===l?void 0:l.id)),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"GO terms"),r.a.createElement("div",{className:"value"},x(null===(c=E)||void 0===c?void 0:c.go_terms,(function(e,t){return r.a.createElement("div",{className:"go-term",key:t},e)}),2))),x(v,(function(e,t){return r.a.createElement("div",{className:"prop",key:t},r.a.createElement("div",{className:"name"},r.a.createElement("span",{className:"accent"},e.relation)," in"),r.a.createElement("div",{className:"value"},e.node.name))}),2,(function(e,t){return r.a.createElement("div",{className:"prop",key:t},r.a.createElement("div",{className:"name"}),r.a.createElement("div",{className:"value"},e))})))})))}),[y]);var O=oe(se,(function(e,t){var n=g(e.selectedNodes,!0),a=n.colors,r=n.sizes;return Object(V.a)({},t,{nodes:e.selectedNodes,colors:a,sizes:r})})),j=oe(ae,(function(e,t){return Object(V.a)({},t,{edges:e.selectedEdges})}));return r.a.createElement(r.a.Fragment,null,r.a.createElement(ae,{edges:n,color:[0,0,0,.2]}),r.a.createElement(j,{edges:[],color:[130/255,179/255,54/255,1]}),r.a.createElement(se,{nodes:t,sizes:h,colors:E}),r.a.createElement(O,{nodes:[],sizes:[],colors:[]}))};n(239);var de=function(e){var t=e.active,n=e.x,a=e.y,o=e.content;return r.a.createElement("div",{className:"tooltip",style:{left:n,top:a,display:t?"block":"none"}},o)},fe=n(111),me=n.n(fe),ve=n(112),pe=n.n(ve),ge={updateSelection:ce};var be=Object(u.b)((function(e){return{targets:e.selection.targets}}),ge)((function(e){var t=e.containerRef,n=e.targets,o=(e.updateSelection,Object(a.useMemo)((function(){var e=new Map,t=!0,a=!1,r=void 0;try{for(var o,i=n.entries()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var s=o.value,l=Object(c.a)(s,2),u=l[0],d=l[1],f=new me.a;f.load(d.points.map((function(e){return Object(V.a)({},e,{minX:e.x,maxX:e.x,minY:e.y,maxY:e.y})}))),e.set(u,f)}}catch(m){a=!0,r=m}finally{try{t||null==i.return||i.return()}finally{if(a)throw r}}return e}),[n])),i=Object(a.useState)(["",-1]),s=Object(c.a)(i,2),l=s[0],u=s[1],d=Object(a.useState)({active:!1,x:0,y:0,content:r.a.createElement(r.a.Fragment,null)}),f=Object(c.a)(d,2),m=f[0],v=f[1];function p(e,t){var a,i=null,s=1/0,d=[0,0],f="",m=!0,p=!1,g=void 0;try{for(var b,E=n.entries()[Symbol.iterator]();!(m=(b=E.next()).done);m=!0){var h=b.value,y=Object(c.a)(h,2),w=y[0],x=y[1],O=o.get(w);if(!O)return;var _=e-x.ctx.gl.domElement.offsetLeft,j=t-x.ctx.gl.domElement.offsetTop,N=x.ctx.size,S=N.width,M=N.height,D=x.ctx.camera,T=(_-S/2)/D.zoom+D.position.x,A=(M-j-M/2)/D.zoom+D.position.y,F=pe()(O,T,A,1);if(F.length>0){var V=F[0],I=[((V.x||0)-D.position.x)*D.zoom+S/2+x.ctx.gl.domElement.offsetLeft,M/2-((V.y||0)-D.position.y)*D.zoom+x.ctx.gl.domElement.offsetTop],P=Math.pow(I[0]-e,2)+Math.pow(I[1]-t,2);(!i||P<s)&&(i=V,s=P,d=I,f=w)}}}catch(C){p=!0,g=C}finally{try{m||null==E.return||E.return()}finally{if(p)throw g}}i&&(f===l[0]&&i.__id===l[1]||(u([f,i.__id]),v({active:!0,x:d[0],y:d[1],content:(null===(a=n.get(f))||void 0===a?void 0:a.tooltipConstructor(i.__id))||r.a.createElement(r.a.Fragment,null)})))}var g=Object(A.a)({onMove:function(e){var t=Object(c.a)(e.xy,2);p(t[0],t[1])},onTouchStart:function(e){var t=e.touches;p(t[0].pageX,t[0].pageY)}},{domTarget:t,event:{passive:!1}});return Object(a.useEffect)((function(){g()}),[g,t]),r.a.createElement(de,m)})),Ee=n(113),he=n.n(Ee),ye=function(e){e.id;var t=e.datasetId,n=e.metadataDatasetId,o=e.goActivityDatasetId,i=Object(p.c)(),s=Object(a.useState)(K.getState().datasets[t]),l=Object(c.a)(s,2),u=l[0],d=l[1],f=Object(a.useState)(K.getState().datasets[n]),m=Object(c.a)(f,2),v=m[0],g=m[1],b=Object(a.useState)(K.getState().datasets[o]),E=Object(c.a)(b,2),h=E[0],y=E[1],w=function(){d(K.getState().datasets[t]),g(K.getState().datasets[n]),y(K.getState().datasets[o])};Object(a.useEffect)((function(){var e=K.subscribe((function(){w()}));return w(),e}),[]),Object(a.useEffect)((function(){u&&K.dispatch(le("primary",u.raw,i,(function(e){var t=v.raw[e],n=v.meta;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"ID"),r.a.createElement("div",{className:"value"},e)),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"Age"),r.a.createElement("div",{className:"value"},n.ageVocab[t.age])),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"Sex"),r.a.createElement("div",{className:"value"},n.sexVocab[t.sex])),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"Tissue"),r.a.createElement("div",{className:"value"},n.tissueVocab[t.tissue])),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"Subtissue"),r.a.createElement("div",{className:"value"},n.subtissueVocab[t.subtissue])),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"Cell type"),r.a.createElement("div",{className:"value"},n.cellOntologyClassVocab[t.cellOntologyClass])))})))}),[u,v]);var x=[0,0,0,.2],O=Object(a.useMemo)((function(){var e=[],t=[];if(!v)return[e,t];var n=v.meta,a=n.ageVocab,r=he()({colormap:"portland",nshades:a.length,format:"float",alpha:.4});return v.raw.forEach((function(o,i){var s=x;s=r[a.indexOf(n.ageVocab[o.age])].slice(),h&&h.raw.length>0&&(s[3]*=Math.pow(h.raw[i]/127,2)),e.push.apply(e,Object(_.a)(s)),t.push(4)})),[e,t]}),[u,v,h]),j=Object(c.a)(O,2),N=j[0],S=j[1];return u?r.a.createElement(se,{nodes:u.raw,colors:N,sizes:S}):r.a.createElement(r.a.Fragment,null)},we={updateDataset:O,setFilterDimensions:function(e,t){return{type:"SET_FILTER_DIMENSIONS",id:e,dimensions:t}},updateExpressionDataset:function(e){return{type:"UPDATE_EXPRESSION_DATASET",dataset:e}},setExpressionDatasetFilterDimensions:function(e){return{type:"SET_EXPRESSION_DATASET_FILTER_DIMENSIONS",dimensions:e}},addExpressionDatasetCustomFilterDimension:function(e,t,n){return{type:"ADD_EXPRESSION_DATASET_CUSTOM_FILTER_DIMENSION",name:e,selector:t,filterFn:n}},setExpressionDatasetFilterValue:x,updatePathways:function(e){return{type:"UPDATE_PATHWAYS",pathways:e}},updateGeneAnnotations:function(e){return{type:"UPDATE_GENE_ANNOTATIONS",geneAnnotations:e}}};var xe=Object(u.b)((function(e){return{nodes:e.pathways.graph.nodes,edges:e.pathways.graph.edges}}),we)((function(e){var t=e.updateDataset,n=(e.setFilterDimensions,e.updateExpressionDataset),o=e.setExpressionDatasetFilterDimensions,i=e.addExpressionDatasetCustomFilterDimension,s=e.setExpressionDatasetFilterValue,u=e.updatePathways,d=e.updateGeneAnnotations,b=e.nodes,E=(e.edges,Object(a.useState)(!0)),h=Object(c.a)(E,2),w=h[0],x=h[1],O=Object(a.useState)("pathways"),_=Object(c.a)(O,2),j=_[0],N=_[1];Object(a.useEffect)((function(){!function(){var e,a,r,c,m,p,g,b,E,h;l.a.async((function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,l.a.awrap(new Promise((function(e,t){v.parse("./data/merged_augmented.csv",{delimiter:",",header:!0,download:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:e,error:t})})));case 2:return e=w.sent,null===n||void 0===n||n(e.data),null===o||void 0===o||o(["start_age","end_age","sex","tissue","subtissue","cell_ontology_class"]),null===s||void 0===s||s("sex","male"),["tissue","subtissue","cell_ontology_class"].map((function(e){return null===s||void 0===s?void 0:s(e,"")})),a=["tissue","subtissue","cell_ontology_class","gene","uniprot_mouse","uniprot_daphnia"],null===i||void 0===i||i("text",(function(e){return a.map((function(t){return e[t]})).join("|").toLowerCase()}),(function(e){return function(t){return t.includes(e.toLowerCase())}})),null===i||void 0===i||i("uniprot_daphnia",(function(e){return e.uniprot_daphnia||""}),(function(e){return"~"===e?function(e){return null!=e&&""!==e}:function(t){return t===e}})),w.next=12,l.a.awrap(f.a.get("./data/pathways_preprocessed.json"));case 12:return r=w.sent,null===u||void 0===u||u(r.data),w.next=16,l.a.awrap(f.a.get("./data/gene_annotations.json"));case 16:return c=w.sent,null===d||void 0===d||d(c.data),w.next=20,l.a.awrap(y("Coords","./data/cell_embeddings.bin"));case 20:for(m=w.sent,p=m.values,g=[],4,b=0;b<p.length;b+=2)g.push({__id:Math.trunc(b/2),x:4*p[b],y:4*p[b+1]});return null===t||void 0===t||t("cellEmbeddings",g),w.next=28,l.a.awrap(y("CellsMetadata","./data/cell_metadata.bin"));case 28:E=w.sent,h={sexVocab:E.sexVocab,ageVocab:E.ageVocab,tissueVocab:E.tissueVocab,subtissueVocab:E.subtissueVocab,cellOntologyClassVocab:E.cellOntologyClassVocab,goActivities:E.goActivities},null===t||void 0===t||t("cellMetadata",E.cells,h),x(!1);case 32:case"end":return w.stop()}}))}()}),[]);var S=Object(a.useMemo)((function(){return new Map}),[]),M=Object(a.useRef)(null),D=Object(a.useMemo)((function(){return(null===b||void 0===b?void 0:b.filter((function(e){var t;return null===(t=e.entityReference)||void 0===t?void 0:t.gene})))||[]}),[b]);return r.a.createElement("div",{className:"App"},r.a.createElement(be,{containerRef:M}),r.a.createElement(T,{mode:j,setMode:function(e){N(e),setTimeout((function(){var e;return null===(e=S.get("embeddings"))||void 0===e?void 0:e.ctx.invalidate()}),100)}}),r.a.createElement("div",{className:"main-canvas",ref:M},r.a.createElement(p.a,{camera:{fov:75,near:1,far:1e4,position:[0,0,1e3],rotation:new m.Euler(0,0,0)},orthographic:!0,pixelRatio:g,invalidateFrameloop:!0,gl2:!0,onCreated:function(e){return function(e,t,n){S.set(e,{ctx:t,containerRef:n})}("embeddings",e,M)}},r.a.createElement(F,{canvasContainerRef:M},"embeddings"===j&&r.a.createElement(ye,{id:"cellEmbeddings",datasetId:"cellEmbeddings",metadataDatasetId:"cellMetadata",goActivityDatasetId:"goActivity"}),"pathways"===j&&r.a.createElement(ue,{nodes:D,edges:[]})))),w&&r.a.createElement("div",{className:"loading"},r.a.createElement("div",{className:"lds-ripple"},r.a.createElement("div",null),r.a.createElement("div",null))))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(u.a,{store:K},r.a.createElement(xe,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[170,1,2]]]);
//# sourceMappingURL=main.8b855771.chunk.js.map