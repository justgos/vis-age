(this["webpackJsonpvis-age"]=this["webpackJsonpvis-age"]||[]).push([[0],{170:function(e,t,a){e.exports=a(244)},175:function(e,t,a){},213:function(e,t,a){},238:function(e,t,a){},239:function(e,t,a){},244:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(15),i=a.n(o),s=(a(175),a(17)),l=a.n(s),c=a(3),u=a(30),d=a(38),f=a.n(d),m=a(4),v=a(101),p=a(27),g=window.devicePixelRatio||1,h=a(102),b=a.n(h),E=function(){var e,t;return l.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,l.a.awrap(f.a.get("./proto/visage.proto"));case 2:return e=a.sent,t=b.a.parse(e.data).root,a.abrupt("return",t);case 5:case"end":return a.stop()}}))},y=function(e,t){var a,n,r;return l.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,l.a.awrap(E());case 2:return a=o.sent,o.next=5,l.a.awrap(f.a.get(t,{responseType:"arraybuffer"}));case 5:return n=o.sent,r=a[e].decode(new Uint8Array(n.data)),o.abrupt("return",r);case 8:case"end":return o.stop()}}))},w="SET_EXPRESSION_DATASET_FILTER_VALUE",x=function(e,t){return{type:w,name:e,value:t}},O=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{type:"UPDATE_DATASET",id:e,dataset:t,meta:a}},j=a(8),_=a(250),N=a(2),S=(a(213),{setFilterValue:x,updateDataset:O}),M=Object(u.b)((function(e){var t;return{filterValues:e.expressionDataset.filterValues,filterValueVocabulary:e.expressionDataset.filterValueVocabulary,cellMetaMetadata:null===(t=e.datasets.cellMetadata)||void 0===t?void 0:t.meta}}),S),T={start_age:"Start age",end_age:"End age",sex:"Sex",tissue:"Tissue",subtissue:"Subtissue",cell_ontology_class:"Cell type"};var D=M((function(e){var t=e.mode,a=e.setMode,o=e.filterValues,i=e.filterValueVocabulary,s=e.cellMetaMetadata,u=e.setFilterValue,d=e.updateDataset,f=Object(n.useState)(-1),m=Object(c.a)(f,2),v=m[0],p=m[1];return r.a.createElement("div",{className:"filter-panel"},r.a.createElement("div",{className:"project-description"},r.a.createElement("h3",null,"Visual exploration of the ",r.a.createElement("a",{href:"https://github.com/czbiohub/tabula-muris-senis"},"Tabula Muris Senis")," dataset"),r.a.createElement("p",null,"Detailed project description and the data preparation code can be found ",r.a.createElement("a",{href:"https://github.com/justgos/indagatio-muris-senis"},"here")),r.a.createElement("div",{className:"mode-label"},"View mode"),r.a.createElement(_.b,{value:t,options:[{label:"Pathways",value:"pathways"},{label:"Embedding",value:"embeddings"}],onChange:function(e){return a(e.target.value)},className:"bp3-fill mode-select"}),"pathways"===t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Fold-changes in expression of various genes overlaid over the reaction network, vertically aligned by the cellular location: nucleus -> extracellular region")),"embeddings"===t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"UMAP embedding of cells by their gene expression, soft-filterable by the cellular processes which the most-expressed genes are associated with"))),"pathways"===t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{className:"filter-element text-filter ".concat(N.a.INPUT," ").concat(N.a.MINIMAL),type:"text",placeholder:"filter by any text field",value:o.get("text")||"",onChange:function(e){return u("text",e.currentTarget.value)}}),r.a.createElement(_.a,{className:"filter-element homolog-filter ".concat(N.a.MINIMAL),checked:null!=o.get("uniprot_daphnia"),onChange:function(e){return u("uniprot_daphnia",e.currentTarget.checked?"~":void 0)}},"has Daphnia homolog")),"embeddings"===t&&s&&r.a.createElement("div",{className:"filter-element"},r.a.createElement("div",{className:"filter-element-label"},"GO activities"),r.a.createElement(_.d,{className:"".concat(N.a.MINIMAL),selectedValue:v,onChange:function(e){return function(e){var t;return l.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(p(e),!(e>=0)){a.next=8;break}return a.next=4,l.a.awrap(y("Activity","./data/go-activity/"+e+".bin"));case 4:t=a.sent,null===d||void 0===d||d("goActivity",t.values),a.next=9;break;case 8:null===d||void 0===d||d("goActivity",[]);case 9:case"end":return a.stop()}}))}(parseInt(e.currentTarget.value))}},r.a.createElement(_.c,{value:-1},"<none>"),s.goActivities.map((function(e,t){return r.a.createElement(_.c,{key:t,value:t},e)})))),"pathways"===t&&["start_age","end_age","sex","tissue","subtissue","cell_ontology_class"].map((function(e){var t;return r.a.createElement("div",{key:e,className:"filter-element"},r.a.createElement("div",{className:"filter-element-label"},T[e]),r.a.createElement(_.d,{className:"".concat(N.a.MINIMAL),selectedValue:o.get(e),onChange:function(t){return u(e,t.currentTarget.value)}},Object(j.a)((null===(t=i.get(e))||void 0===t?void 0:t.entries())||[]).map((function(e){return r.a.createElement(_.c,{key:e[0],value:e[0]},""!==e[0]?e[0]:"<none>",r.a.createElement("span",{className:"count"},e[1]))}))))})))})),A=a(50);function F(e){var t=e.children,a=e.canvasContainerRef,o=Object(p.c)(),i=o.mouse,s=o.size,l=s.width,u=s.height,d=o.camera,f=o.invalidate,v=Object(n.useMemo)((function(){return[{value:0},{value:performance.now()},{value:performance.now()}]}),[]),g=Object(c.a)(v,3),h=g[0],b=g[1],E=g[2],y=Object(n.useRef)(),w=Object(n.useRef)(),x=Object(n.useMemo)((function(){return[new m.Vector3,{x:0,y:0,z:0,k:.25,vec:new m.Vector3,spherical:new m.Spherical}]}),[]),O=Object(c.a)(x,2),j=(O[0],O[1]);var _=Object(A.a)({onDrag:function(e){var t=e.event,a=e.last,n=e.down,r=Object(c.a)(e.delta,2),o=r[0],i=r[1],s=e.buttons,l=e.touches;!n||1!==s&&1!==l||(j.x-=o/j.k,j.y+=i/j.k,f()),a||null===t||void 0===t||t.preventDefault(),n&&f()},onWheel:function(e){var t=e.event,a=e.last,n=Object(c.a)(e.delta,2),r=n[0],o=n[1];if(0!==r||0!==o){var s=[.5*i.x*l/d.zoom+d.position.x,.5*i.y*u/d.zoom+d.position.y],m=Object(c.a)(s,2),v=m[0],p=m[1],g=1-.002*o;j.x+=(v-j.x)*-(1-g),j.y+=(p-j.y)*-(1-g),j.k*=g,f()}a||null===t||void 0===t||t.preventDefault()},onPinch:function(e){var t,a,n=e.event,r=e.first,o=e.last,i=e.down,s=Object(c.a)(e.da,2),f=s[0],m=(s[1],Object(c.a)(e.previous,2)),v=m[0],p=(m[1],e.origin),g=e.memo;if(i&&!r){var h=f/v;j.x+=(g[0]-j.x)*-(1-h),j.y+=(g[1]-j.y)*-(1-h),j.k*=h}return o||null===n||void 0===n||n.preventDefault(),r?(t=(null===p||void 0===p?void 0:p[0])||0,a=(null===p||void 0===p?void 0:p[1])||0,[(t-.5*l)/d.zoom+d.position.x,(u-a-.5*u)/d.zoom+d.position.y]):g}},{domTarget:a,event:{passive:!1}});return Object(n.useEffect)((function(){_()}),[_]),Object(p.b)((function(){var e=performance.now();b.value=e,h.value++,e>E.value+1e3&&(E.value=e,h.value=0),d.position.x=j.x,d.position.y=j.y,d.zoom=j.k,d.updateProjectionMatrix()})),r.a.createElement("scene",{ref:y},r.a.createElement("ambientLight",{intensity:.5}),r.a.createElement("directionalLight",{intensity:.6,position:[0,0,1e3],rotation:new m.Euler(0,0,0),castShadow:!0,ref:w}),t)}a(238);var P=a(6),V=a(42),I=a(51),C={raw:[],filteredGeneExpression:new Map,filterValues:new Map,filterValueVocabulary:new Map,filterDimensionNames:[],customFilterFunctions:new Map,filtered:[],raw2filtered:new Map},R=function(e){return e.filterDimensionNames.forEach((function(t){var a,n=null===(a=e.filterDimensions)||void 0===a?void 0:a.get(t);if(n){var r=n.group().reduceCount().all().slice().sort((function(e,t){return e.key.localeCompare(t.key,"en",{numeric:!0})}));e.filterValueVocabulary.set(t,new Map(r.map((function(e){return[e.key,e.value]}))))}})),e},k=function(e){if(!e.crossfilter||!e.filterDimensions)return e;var t=!0,a=!1,n=void 0;try{for(var r,o=e.filterDimensions.entries()[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var i=r.value,s=Object(c.a)(i,2),l=s[0],u=s[1];u.filterAll();var d=e.filterValues.get(l);if(null!=d){var f=e.customFilterFunctions.get(l);f?u.filterFunction(f(d)):u.filter(d)}}}catch(p){a=!0,n=p}finally{try{t||null==o.return||o.return()}finally{if(a)throw n}}e.filtered=e.crossfilter.allFiltered(),e.raw2filtered.clear(),e.filtered.forEach((function(t,a){return e.raw2filtered.set(t.__id||-1,a)})),e.filteredGeneExpression=new Map;for(var m=0;m<e.filtered.length;m++){var v=e.filtered[m];v.gene&&e.filteredGeneExpression.set(v.gene,v)}return e=R(e)},z={},L=function(e){return e.filterDimensionNames.forEach((function(t){var a,n=null===(a=e.filterDimensions)||void 0===a?void 0:a.get(t);if(n){var r=n.group().reduceCount().all().slice().sort((function(e,t){return e.key.localeCompare(t.key,"en",{numeric:!0})}));e.filterValueVocabulary.set(t,new Map(r.map((function(e){return[e.key,e.value]}))))}})),e},U=function(e){if(!e.crossfilter||!e.filterDimensions)return e;var t=!0,a=!1,n=void 0;try{for(var r,o=e.filterDimensions.entries()[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var i=r.value,s=Object(c.a)(i,2),l=s[0],u=s[1];u.filterAll();var d=e.filterValues.get(l);if(null!=d){var f=e.customFilterFunctions.get(l);f?u.filterFunction(f(d)):u.filter(d)}}}catch(m){a=!0,n=m}finally{try{t||null==o.return||o.return()}finally{if(a)throw n}}return e.filtered=e.crossfilter.allFiltered(),e.raw2filtered.clear(),e.filtered.forEach((function(t,a){return e.raw2filtered.set(t.__id||-1,a)})),e},X=a(53),G=function(e,t){var a=[],n=[],r=new Map;e.forEach((function(e){return function(e){var t=Object(P.a)({},e,{location:0,x:1e3*(Math.random()-.5),y:1e3*(Math.random()-.5),vx:0,vy:0});if("molecule"===e.type&&e.cellularLocation){var n=e.cellularLocation;["extracellular region","external side of plasma membrane","cell junction"].some((function(e){return null===n||void 0===n?void 0:n.includes(e)}))?t.location=5:["cell outer membrane","cell wall","cell membrane","cytoplasmic side of plasma membrane","plasma membrane"].some((function(e){return null===n||void 0===n?void 0:n.includes(e)}))?t.location=4:["mitochondrial"].some((function(e){return null===n||void 0===n?void 0:n.includes(e)}))?t.location=3:["cytosol","host cell cytosol"].some((function(e){return null===n||void 0===n?void 0:n.includes(e)}))?t.location=0:["golgi"].some((function(e){return null===n||void 0===n?void 0:n.includes(e)}))?t.location=-3:["endoplasmic reticulum"].some((function(e){return null===n||void 0===n?void 0:n.includes(e)}))?t.location=-4:["nuclear envelope","nucleoplasm","nucleus","nucleolus","nuclear","chromosome","chromosome, centromeric region"].some((function(e){return null===n||void 0===n?void 0:n.includes(e)}))&&(t.location=-5)}a.push(t)}(e)})),t.forEach((function(e){return function(e){var t=Object(P.a)({},e),a=r.get(e.source);a||(a=[],r.set(e.source,a)),a.push(t);var o=r.get(e.target);o||(o=[],r.set(e.target,o)),o.push(t),n.push(t)}(Object(P.a)({},e,{sourcePos:[0,0],targetPos:[0,0]}))}));for(var o=function(e){var t=a[e];if("reaction"===t.type||"control"===t.type||"template_reaction"===t.type){var n=r.get(t.__id);if(n&&n.length>0){var o=n.map((function(e){return a[e.source===t.__id?e.target:e.source].location})).reduce((function(e,t){return e+t}),0)/n.length;t.location=o}}},i=0;i<a.length;i++)o(i);var s=Object(X.c)(a),l=JSON.parse(JSON.stringify(Array.from(r).map((function(e){return e[1]}))));s.force("charge",Object(X.b)().strength(-30)).force("link",Object(X.a)(l.reduce((function(e,t){return[].concat(Object(j.a)(e),Object(j.a)(t))}),[])).distance((function(e){return Math.max(250*Math.abs(e.target.location-e.source.location),10)}))).force("center",B(0,0,(function(e){}),(function(e){return null!=e.location?250*e.location:void 0}))),s.stop();var c=s.nodes(),u=[];return u.length===c.length?s.nodes().forEach((function(e,t){e.x=u[t].x,e.y=u[t].y})):(s.tick(50),u=c.map((function(e){return{x:e.x,y:e.y}}))),s.nodes().forEach((function(e,t){a[t].x=e.x,a[t].y=e.y,a[t].minX=e.x,a[t].maxX=e.x,a[t].minY=e.y,a[t].maxY=e.y})),n.forEach((function(e){e.sourcePos=[a[e.source].x,a[e.source].y],e.targetPos=[a[e.target].x,a[e.target].y]})),{nodes:a,edges:n,edgeMap:r}},Y=function(e){var t={nodes:JSON.parse(JSON.stringify(e.nodes)),edges:[],edgeMap:new Map};return t.nodes.forEach((function(e){e.vx=0,e.vy=0,e.minX=e.x,e.maxX=e.x,e.minY=e.y,e.maxY=e.y})),e.edges.forEach((function(e){var a={source:e[0],target:e[1],relation:e[2],sourcePos:[0,0],targetPos:[0,0]};a.sourcePos=[t.nodes[a.source].x,t.nodes[a.source].y],a.targetPos=[t.nodes[a.target].x,t.nodes[a.target].y];var n=t.edgeMap.get(a.source);n||(n=[],t.edgeMap.set(a.source,n)),n.push(a);var r=t.edgeMap.get(a.target);r||(r=[],t.edgeMap.set(a.target,r)),r.push(a)})),t},B=function(e,t,a,n){var r,o,i,s,l=function(e){return function(){return e}},c=function(e){return 0===e.location?.2:5};function u(a){var n,l,c=r.length,u=0,d=0;for(n=0;n<c;++n)u+=(l=r[n]).x,d+=l.y;for(u=u/c-e,d=d/c-t,n=0;n<c;++n)l=r[n];for(var f=0,m=r.length;f<m;++f)l=r[f],null!=i[f]&&l.vx&&(l.vx+=(i[f]-l.x)*o[f]*a),null!=s[f]&&l.vy&&(l.vy+=(s[f]-l.y)*o[f]*a)}function d(){if(r){var e,t=r.length;for(o=new Array(t),i=new Array(t),s=new Array(t),e=0;e<t;++e)i[e]=a(r[e],e,r),s[e]=n(r[e],e,r),o[e]=+c(r[e])}}return u.initialize=function(e){r=e,d()},u.strength=function(e){return arguments.length?(c="function"===typeof e?e:l(+e),d(),u):c},u.x=function(e){return arguments.length?(a="function"===typeof e?e:l(+e),d(),u):a},u.y=function(e){return arguments.length?(n="function"===typeof e?e:l(+e),d(),u):n},u},J={raw:{nodes:[],edges:[]},graph:{nodes:[],edges:[],edgeMap:new Map},geneAnnotations:{genes:new Map}},W=function(e){return e.graph=G(e.raw.nodes.map((function(e){return e})),e.raw.edges.map((function(e){return{source:e[0],target:e[1],relation:e[2]}}))),e},H={active:!1,x:0,y:0,content:r.a.createElement(r.a.Fragment,null)},q={targets:new Map,selectedNodes:[],selectedEdges:[]},$=Object(V.b)({expressionDataset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UPDATE_EXPRESSION_DATASET":e.raw=t.dataset;for(var a=0;a<e.raw.length;a++){var n=e.raw[a];n.__id=a}return Object(P.a)({},e);case"SET_EXPRESSION_DATASET_FILTER_DIMENSIONS":var r=t;return e.crossfilter=Object(I.a)(e.raw),e.filterDimensions=new Map,e.filterDimensionNames=r.dimensions,e.filterDimensionNames.forEach((function(t){e.crossfilter&&e.filterDimensions&&e.filterDimensions.set(t,e.crossfilter.dimension((function(e){return e[t]||""})))})),e.filterValues=new Map,(e=R(e)).filterDimensionNames.forEach((function(t){var a;e.filterValues.set(t,(null===(a=e.filterValueVocabulary.get(t))||void 0===a?void 0:a.entries().next().value[0])||"")})),e=k(e),Object(P.a)({},e);case"ADD_EXPRESSION_DATASET_CUSTOM_FILTER_DIMENSION":var o=t;return e.filterDimensions&&e.crossfilter?(e.filterDimensions.set(o.name,e.crossfilter.dimension(o.selector)),o.filterFn&&e.customFilterFunctions.set(o.name,o.filterFn),e=k(e),Object(P.a)({},e)):(console.error("Trying to add a custom filter dimension before SET_FILTER_DIMENSIONS was called"),e);case w:var i=t;return e.filterValues.set(i.name,i.value),e.filterValues=new Map(e.filterValues),e=k(e),Object(P.a)({},e);default:return e}},datasets:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UPDATE_DATASET":var a=t;return e[a.id]={raw:a.dataset,meta:a.meta,filterValues:new Map,filterValueVocabulary:new Map,filterDimensionNames:[],customFilterFunctions:new Map,filtered:[],raw2filtered:new Map},Object(P.a)({},e);case"SET_FILTER_DIMENSIONS":var n=t,r=e[n.id];return r.crossfilter=Object(I.a)(r.raw),r.filterDimensions=new Map,r.filterDimensionNames=n.dimensions,r.filterDimensionNames.forEach((function(e){r.crossfilter&&r.filterDimensions&&r.filterDimensions.set(e,r.crossfilter.dimension((function(t){return t[e]||""})))})),r.filterValues=new Map,r.filterValueVocabulary=new Map,r=L(r),r=U(r),e[n.id]=r,Object(P.a)({},e);case"ADD_CUSTOM_FILTER_DIMENSION":var o=t,i=e[o.id];return i.filterDimensions&&i.crossfilter?(i.filterDimensions.set(o.name,i.crossfilter.dimension(o.selector)),o.filterFn&&i.customFilterFunctions.set(o.name,o.filterFn),i=U(i),e[o.id]=i,Object(P.a)({},e)):(console.error("Trying to add a custom filter dimension before SET_FILTER_DIMENSIONS was called"),e);case"SET_FILTER_VALUE":var s=t,l=e[s.id];return l.filterValues.set(s.name,s.value),l.filterValues=new Map(l.filterValues),l=U(l),e[s.id]=l,Object(P.a)({},e);default:return e}},pathways:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UPDATE_PATHWAYS":var a=t;return a.pathways.dehydrated?e.graph=Y(a.pathways):(e.raw=a.pathways,e=W(e)),Object(P.a)({},e);case"UPDATE_GENE_ANNOTATIONS":var n=t;return e.geneAnnotations={genes:new Map},n.geneAnnotations.forEach((function(t){return e.geneAnnotations.genes.set(t.name,t)})),Object(P.a)({},e);case"UPDATE_FILTER":return Object(P.a)({},e);default:return e}},tooltip:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UPDATE_TOOLTIP":return e.x=t.x,e.y=t.y,e.content=t.content,e.active=!0,Object(P.a)({},e);case"HIDE_TOOLTIP":return e.active=!1,Object(P.a)({},e);default:return e}},selection:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UPDATE_TARGET":var a=t;return e.targets.set(a.id,{points:a.points,ctx:a.ctx,tooltipConstructor:a.tooltipConstructor}),e.targets=new Map(e.targets),Object(P.a)({},e);case"UPDATE_SELECTION":return e.selectedNodes=t.selectedNodes,e.selectedEdges=t.selectedEdges,Object(P.a)({},e);default:return e}}}),K=Object(V.c)($),Q=a(22),Z=a(28),ee=a(25),te=a(26),ae=function(e){function t(){var e;return Object(Q.a)(this,t),(e=Object(Z.a)(this,Object(ee.a)(t).call(this,{vertexShader:"\n        // attribute vec2 uv;\n        varying vec2 texcoord;\n        attribute vec4 color;\n        varying vec4 vColor;\n\n        void main() {\n            vec4 mvPosition = modelViewMatrix * vec4( position.xyz, 1.0 );\n            gl_Position = projectionMatrix * mvPosition;\n            texcoord = uv;\n            vColor = color;\n        }\n      ",fragmentShader:"\n        varying vec2 texcoord;\n        varying vec4 vColor;\n        void main() {\n          gl_FragColor = vColor;\n          gl_FragColor.w *= (1.0 - pow(texcoord.x, 4.0));\n          // gl_FragColor.w *= 0.2;\n        }\n      ",blendSrc:m.SrcAlphaFactor,blendDst:m.OneMinusSrcAlphaFactor,blending:m.CustomBlending,transparent:!0}))).uniforms={map:{value:null}},e}return Object(te.a)(t,e),t}(m.ShaderMaterial);var ne=function(e){var t=e.edges,a=e.color,o=Object(n.useMemo)((function(){var e=[],n=[],r=[];return t.forEach((function(t){return o=t,e.push(o.sourcePos[0],o.sourcePos[1],0,o.targetPos[0],o.targetPos[1],0),n.push(0,0,1,1),r.push.apply(r,Object(j.a)(a)),void r.push.apply(r,Object(j.a)(a));var o})),[new m.BufferAttribute(new Float32Array(e),3),new m.BufferAttribute(new Float32Array(n),2),new m.BufferAttribute(new Float32Array(r),4)]}),[t]),i=Object(c.a)(o,3),s=i[0],l=i[1],u=i[2],d=Object(n.useMemo)((function(){return[new ae]}),[]),f=Object(c.a)(d,1)[0];return r.a.createElement("lineSegments",{frustumCulled:!1,material:f},r.a.createElement("bufferGeometry",{attach:"geometry",attributes:{position:s,uv:l,color:u}}))},re=a(110),oe=function(e,t){return function(a){function n(e){var t;return Object(Q.a)(this,n),(t=Object(Z.a)(this,Object(ee.a)(n).call(this,e))).subscription=function(){},t._mounted=!1,t.state={selection:{targets:new Map,selectedNodes:[],selectedEdges:[]}},t}return Object(te.a)(n,a),Object(re.a)(n,[{key:"handleStoreUpdate",value:function(){this._mounted&&this.setState({selection:Object(P.a)({},K.getState().selection)})}},{key:"componentDidMount",value:function(){this._mounted=!0,this.subscription=K.subscribe(this.handleStoreUpdate.bind(this)),this.handleStoreUpdate()}},{key:"componentWillUnmount",value:function(){this._mounted=!1,this.subscription()}},{key:"render",value:function(){var a=t(this.state.selection,this.props);return r.a.createElement(e,a)}}]),n}(r.a.Component)},ie=function(e){function t(e){var a;return Object(Q.a)(this,t),(a=Object(Z.a)(this,Object(ee.a)(t).call(this,{vertexShader:"\n        attribute float size;\n        attribute vec4 color;\n        varying vec4 vColor;\n\n        void main() {\n            vec4 mvPosition = modelViewMatrix * vec4( position.xyz, 1.0 );\n            float projectionSize = abs((projectionMatrix[0][0] + projectionMatrix[1][1]) / 2.0 * 300.0);\n            gl_PointSize = 1.0 * size * pow(projectionSize, 0.3);\n            // gl_PointSize = 1.0 * size;\n            gl_Position = projectionMatrix * mvPosition;\n            vColor = color;\n            // if(size == 0.0)\n            //   color.w = 0.0;\n        }\n      ",fragmentShader:"\n        uniform sampler2D pointTexture;\n        varying vec4 vColor;\n        void main() {\n          gl_FragColor = vColor * texture2D(pointTexture, gl_PointCoord);\n          // gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n          // gl_FragColor.w *= 0.4;\n        }\n      ",blending:m.NormalBlending,transparent:!0}))).uniforms={pointTexture:{value:e.pointTexture}},a}return Object(te.a)(t,e),t}(m.ShaderMaterial);var se=function(e){var t=e.nodes,a=e.sizes,o=e.colors,i=Object(n.useMemo)((function(){var e=[];return t.forEach((function(t){return a=t,void e.push(a.x,a.y,a.z||0);var a})),[new m.BufferAttribute(new Float32Array(e),3)]}),[t]),s=Object(c.a)(i,1)[0],l=Object(n.useMemo)((function(){return[new m.BufferAttribute(new Float32Array(a),1),new m.BufferAttribute(new Float32Array(o),4)]}),[a,o]),u=Object(c.a)(l,2),d=u[0],f=u[1],v=Object(n.useMemo)((function(){var e=new m.TextureLoader;return[new ie({pointTexture:e.load("./textures/circle.png")})]}),[]),p=Object(c.a)(v,1)[0];return t.length<1?r.a.createElement(r.a.Fragment,null):r.a.createElement("points",{frustumCulled:!1,material:p},r.a.createElement("bufferGeometry",{attach:"geometry",attributes:{position:s,size:d,color:f}}))},le=function(e,t,a,n){return{type:"UPDATE_TARGET",id:e,points:t,ctx:a,tooltipConstructor:n}},ce=function(e,t){return{type:"UPDATE_SELECTION",selectedNodes:e,selectedEdges:t}},ue=function(e){var t=e.nodes,a=e.edges,o=Object(p.c)(),i=[0,0,0,.1],s=[251/255,101/255,66/255,.4],l=[55/255,94/255,151/255,.4],u=Object(n.useState)(K.getState().expressionDataset.filteredGeneExpression),d=Object(c.a)(u,2),f=d[0],m=d[1],v=function(){m(K.getState().expressionDataset.filteredGeneExpression)};function g(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=[],n=[],r=[],o=new Map,c=0;c<e.length;c++){var u=e[c],d=!1,m=-1,v=i,p=10;if("molecule"===u.type){var g,h,b=null===(g=u.entityReference)||void 0===g?void 0:null===(h=g.gene)||void 0===h?void 0:h.name;if(b){var E=f.get(b);if(null!=E){d=!0,m=E.__id||-1;var y=E.fold_change_log2||0;p=2*Math.sqrt(Math.abs(y))*13,v=y>0?s:l}}}t&&((v=v.slice())[3]=5),d&&r.push(e[c]),o.set(u.__id,m),a.push.apply(a,Object(j.a)(v)),n.push(p)}return{colors:a,sizes:n,filteredNodes:r,refExpressionRows:o}}Object(n.useEffect)((function(){var e=K.subscribe((function(){v()}));return v(),e}),[]);var h=Object(n.useMemo)((function(){return g(t)}),[t,f]),b=h.colors,E=h.sizes,y=h.filteredNodes,w=h.refExpressionRows,x=function(e,t,a,n){var o=0,i=[];if(null==e)return i.push(r.a.createElement("div",{key:0},"\u2014")),i;for(;o<e.length&&o<a;)i.push(t(e[o],o)),o++;if(o<e.length){var s=r.a.createElement("div",{className:"list-truncation-notice",key:o+1},e.length-o," more..");n&&(s=n(s,o+1)),i.push(s)}return i};Object(n.useEffect)((function(){K.dispatch(le("primary",y,o,(function(e){var t,a,n,o,i,s,l,c,u=K.getState().pathways.graph,d=u.nodes[e],f=w.get(d.__id),m=f&&f>=0?K.getState().expressionDataset.raw[f]:void 0,v=Array.from(new Set((u.edgeMap.get(d.__id)||[]).map((function(e){return{node:u.nodes[e.source===d.__id?e.target:e.source],relation:e.relation}})))),p=v.map((function(e){return u.edgeMap.get(e.node.__id)||[]})).reduce((function(e,t){return[].concat(Object(j.a)(e),Object(j.a)(t))}),[]),g={};p.forEach((function(e){g[e.source]=u.nodes[e.source],g[e.target]=u.nodes[e.target]})),K.dispatch(ce(Object.values(g),p));var h=null===(t=d.entityReference)||void 0===t?void 0:null===(a=t.gene)||void 0===a?void 0:a.name,b=void 0;return h&&(b=K.getState().pathways.geneAnnotations.genes.get(h)),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"Name"),r.a.createElement("div",{className:"value"},h||d.name)),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"Location"),r.a.createElement("div",{className:"value"},d.cellularLocation)),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"log",r.a.createElement("sub",null,"2"),"(Fold-change)"),r.a.createElement("div",{className:"value",style:{color:((null===m||void 0===m?void 0:m.fold_change_log2)||0)>0?"#fb6542":"#375e97"}},null===m||void 0===m?void 0:null===(n=m.fold_change_log2)||void 0===n?void 0:n.toFixed(2))),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"xref"),r.a.createElement("div",{className:"value"},null===(o=d.entityReference)||void 0===o?void 0:null===(i=o.xref)||void 0===i?void 0:i.db,":",null===(s=d.entityReference)||void 0===s?void 0:null===(l=s.xref)||void 0===l?void 0:l.id)),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"GO terms"),r.a.createElement("div",{className:"value"},x(null===(c=b)||void 0===c?void 0:c.go_terms,(function(e,t){return r.a.createElement("div",{className:"go-term",key:t},e)}),2))),x(v,(function(e,t){return r.a.createElement("div",{className:"prop",key:t},r.a.createElement("div",{className:"name"},r.a.createElement("span",{className:"accent"},e.relation)," in"),r.a.createElement("div",{className:"value"},e.node.name))}),2,(function(e,t){return r.a.createElement("div",{className:"prop",key:t},r.a.createElement("div",{className:"name"}),r.a.createElement("div",{className:"value"},e))})))})))}),[y]);var O=oe(se,(function(e,t){var a=g(e.selectedNodes,!0),n=a.colors,r=a.sizes;return Object(P.a)({},t,{nodes:e.selectedNodes,colors:n,sizes:r})})),_=oe(ne,(function(e,t){return Object(P.a)({},t,{edges:e.selectedEdges})}));return r.a.createElement(r.a.Fragment,null,r.a.createElement(ne,{edges:a,color:[0,0,0,.2]}),r.a.createElement(_,{edges:[],color:[130/255,179/255,54/255,1]}),r.a.createElement(se,{nodes:t,sizes:E,colors:b}),r.a.createElement(O,{nodes:[],sizes:[],colors:[]}))};a(239);var de=function(e){var t=e.active,a=e.x,n=e.y,o=e.content;return r.a.createElement("div",{className:"tooltip",style:{left:a,top:n,display:t?"block":"none"}},o)},fe=a(111),me=a.n(fe),ve=a(112),pe=a.n(ve),ge={updateSelection:ce};var he=Object(u.b)((function(e){return{targets:e.selection.targets}}),ge)((function(e){var t=e.containerRef,a=e.targets,o=(e.updateSelection,Object(n.useMemo)((function(){var e=new Map,t=!0,n=!1,r=void 0;try{for(var o,i=a.entries()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var s=o.value,l=Object(c.a)(s,2),u=l[0],d=l[1],f=new me.a;f.load(d.points.map((function(e){return Object(P.a)({},e,{minX:e.x,maxX:e.x,minY:e.y,maxY:e.y})}))),e.set(u,f)}}catch(m){n=!0,r=m}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}return e}),[a])),i=Object(n.useState)(["",-1]),s=Object(c.a)(i,2),l=s[0],u=s[1],d=Object(n.useState)({active:!1,x:0,y:0,content:r.a.createElement(r.a.Fragment,null)}),f=Object(c.a)(d,2),m=f[0],v=f[1];function p(e,t){var n,i=null,s=1/0,d=[0,0],f="",m=!0,p=!1,g=void 0;try{for(var h,b=a.entries()[Symbol.iterator]();!(m=(h=b.next()).done);m=!0){var E=h.value,y=Object(c.a)(E,2),w=y[0],x=y[1],O=o.get(w);if(!O)return;var j=e-x.ctx.gl.domElement.offsetLeft,_=t-x.ctx.gl.domElement.offsetTop,N=x.ctx.size,S=N.width,M=N.height,T=x.ctx.camera,D=(j-S/2)/T.zoom+T.position.x,A=(M-_-M/2)/T.zoom+T.position.y,F=pe()(O,D,A,1);if(F.length>0){var P=F[0],V=[((P.x||0)-T.position.x)*T.zoom+S/2+x.ctx.gl.domElement.offsetLeft,M/2-((P.y||0)-T.position.y)*T.zoom+x.ctx.gl.domElement.offsetTop],I=Math.pow(V[0]-e,2)+Math.pow(V[1]-t,2);(!i||I<s)&&(i=P,s=I,d=V,f=w)}}}catch(C){p=!0,g=C}finally{try{m||null==b.return||b.return()}finally{if(p)throw g}}i&&(f===l[0]&&i.__id===l[1]||(u([f,i.__id]),v({active:!0,x:d[0],y:d[1],content:(null===(n=a.get(f))||void 0===n?void 0:n.tooltipConstructor(i.__id))||r.a.createElement(r.a.Fragment,null)})))}var g=Object(n.useMemo)((function(){return{nTouches:0,lastTouchPos:[0,0],touchStartPos:[0,0]}}),[]),h=Object(A.a)({onMove:function(e){var t=Object(c.a)(e.xy,2);p(t[0],t[1])},onTouchStart:function(e){var t=e.touches;0===g.nTouches&&(g.touchStartPos=[t[0].pageX,t[0].pageY]),g.nTouches=Math.max(g.nTouches,t.length),g.lastTouchPos=[t[0].pageX,t[0].pageY]},onTouchMove:function(e){var t=e.touches;g.lastTouchPos=[t[0].pageX,t[0].pageY]},onTouchEnd:function(e){var t=e.touches;1===g.nTouches&&Math.abs(g.touchStartPos[0]-g.lastTouchPos[0])<=5&&Math.abs(g.touchStartPos[1]-g.lastTouchPos[1])<=5&&p(g.lastTouchPos[0],g.lastTouchPos[1]),t.length<1&&(g.nTouches=0)}},{domTarget:t,event:{passive:!1}});return Object(n.useEffect)((function(){h()}),[h,t,o]),r.a.createElement(de,m)})),be=a(113),Ee=a.n(be),ye=function(e){e.id;var t=e.datasetId,a=e.metadataDatasetId,o=e.goActivityDatasetId,i=Object(p.c)(),s=Object(n.useState)(K.getState().datasets[t]),l=Object(c.a)(s,2),u=l[0],d=l[1],f=Object(n.useState)(K.getState().datasets[a]),m=Object(c.a)(f,2),v=m[0],g=m[1],h=Object(n.useState)(K.getState().datasets[o]),b=Object(c.a)(h,2),E=b[0],y=b[1],w=function(){d(K.getState().datasets[t]),g(K.getState().datasets[a]),y(K.getState().datasets[o])};Object(n.useEffect)((function(){var e=K.subscribe((function(){w()}));return w(),e}),[]),Object(n.useEffect)((function(){u&&K.dispatch(le("primary",u.raw,i,(function(e){var t=v.raw[e],a=v.meta;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"ID"),r.a.createElement("div",{className:"value"},e)),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"Age"),r.a.createElement("div",{className:"value"},a.ageVocab[t.age])),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"Sex"),r.a.createElement("div",{className:"value"},a.sexVocab[t.sex])),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"Tissue"),r.a.createElement("div",{className:"value"},a.tissueVocab[t.tissue])),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"Subtissue"),r.a.createElement("div",{className:"value"},a.subtissueVocab[t.subtissue])),r.a.createElement("div",{className:"prop"},r.a.createElement("div",{className:"name"},"Cell type"),r.a.createElement("div",{className:"value"},a.cellOntologyClassVocab[t.cellOntologyClass])))})))}),[u,v]);var x=[0,0,0,.2],O=Object(n.useMemo)((function(){var e=[],t=[];if(!v)return[e,t];var a=v.meta,n=a.ageVocab,r=Ee()({colormap:"portland",nshades:n.length,format:"float",alpha:.4});return v.raw.forEach((function(o,i){var s=x;s=r[n.indexOf(a.ageVocab[o.age])].slice(),E&&E.raw.length>0&&(s[3]*=Math.pow(E.raw[i]/127,2)),e.push.apply(e,Object(j.a)(s)),t.push(4)})),[e,t]}),[u,v,E]),_=Object(c.a)(O,2),N=_[0],S=_[1];return u?r.a.createElement(se,{nodes:u.raw,colors:N,sizes:S}):r.a.createElement(r.a.Fragment,null)},we={updateDataset:O,setFilterDimensions:function(e,t){return{type:"SET_FILTER_DIMENSIONS",id:e,dimensions:t}},updateExpressionDataset:function(e){return{type:"UPDATE_EXPRESSION_DATASET",dataset:e}},setExpressionDatasetFilterDimensions:function(e){return{type:"SET_EXPRESSION_DATASET_FILTER_DIMENSIONS",dimensions:e}},addExpressionDatasetCustomFilterDimension:function(e,t,a){return{type:"ADD_EXPRESSION_DATASET_CUSTOM_FILTER_DIMENSION",name:e,selector:t,filterFn:a}},setExpressionDatasetFilterValue:x,updatePathways:function(e){return{type:"UPDATE_PATHWAYS",pathways:e}},updateGeneAnnotations:function(e){return{type:"UPDATE_GENE_ANNOTATIONS",geneAnnotations:e}}};var xe=Object(u.b)((function(e){return{nodes:e.pathways.graph.nodes,edges:e.pathways.graph.edges}}),we)((function(e){var t=e.updateDataset,a=(e.setFilterDimensions,e.updateExpressionDataset),o=e.setExpressionDatasetFilterDimensions,i=e.addExpressionDatasetCustomFilterDimension,s=e.setExpressionDatasetFilterValue,u=e.updatePathways,d=e.updateGeneAnnotations,h=e.nodes,b=(e.edges,Object(n.useState)(!0)),E=Object(c.a)(b,2),w=E[0],x=E[1],O=Object(n.useState)("pathways"),j=Object(c.a)(O,2),_=j[0],N=j[1];Object(n.useEffect)((function(){!function(){var e,n,r,c,m,p,g,h,b,E;l.a.async((function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,l.a.awrap(new Promise((function(e,t){v.parse("./data/merged_augmented.csv",{delimiter:",",header:!0,download:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:e,error:t})})));case 2:return e=w.sent,null===a||void 0===a||a(e.data),null===o||void 0===o||o(["start_age","end_age","sex","tissue","subtissue","cell_ontology_class"]),null===s||void 0===s||s("sex","male"),["tissue","subtissue","cell_ontology_class"].map((function(e){return null===s||void 0===s?void 0:s(e,"")})),n=["tissue","subtissue","cell_ontology_class","gene","uniprot_mouse","uniprot_daphnia"],null===i||void 0===i||i("text",(function(e){return n.map((function(t){return e[t]})).join("|").toLowerCase()}),(function(e){return function(t){return t.includes(e.toLowerCase())}})),null===i||void 0===i||i("uniprot_daphnia",(function(e){return e.uniprot_daphnia||""}),(function(e){return"~"===e?function(e){return null!=e&&""!==e}:function(t){return t===e}})),w.next=12,l.a.awrap(f.a.get("./data/pathways_preprocessed.json"));case 12:return r=w.sent,null===u||void 0===u||u(r.data),w.next=16,l.a.awrap(f.a.get("./data/gene_annotations.json"));case 16:return c=w.sent,null===d||void 0===d||d(c.data),w.next=20,l.a.awrap(y("Coords","./data/cell_embeddings.bin"));case 20:for(m=w.sent,p=m.values,g=[],4,h=0;h<p.length;h+=2)g.push({__id:Math.trunc(h/2),x:4*p[h],y:4*p[h+1]});return null===t||void 0===t||t("cellEmbeddings",g),w.next=28,l.a.awrap(y("CellsMetadata","./data/cell_metadata.bin"));case 28:b=w.sent,E={sexVocab:b.sexVocab,ageVocab:b.ageVocab,tissueVocab:b.tissueVocab,subtissueVocab:b.subtissueVocab,cellOntologyClassVocab:b.cellOntologyClassVocab,goActivities:b.goActivities},null===t||void 0===t||t("cellMetadata",b.cells,E),x(!1);case 32:case"end":return w.stop()}}))}()}),[]);var S=Object(n.useMemo)((function(){return new Map}),[]),M=Object(n.useRef)(null),T=Object(n.useMemo)((function(){return(null===h||void 0===h?void 0:h.filter((function(e){var t;return null===(t=e.entityReference)||void 0===t?void 0:t.gene})))||[]}),[h]);return r.a.createElement("div",{className:"App"},r.a.createElement(he,{containerRef:M}),r.a.createElement(D,{mode:_,setMode:function(e){N(e),setTimeout((function(){var e;return null===(e=S.get("embeddings"))||void 0===e?void 0:e.ctx.invalidate()}),100)}}),r.a.createElement("div",{className:"main-canvas",ref:M},r.a.createElement(p.a,{camera:{fov:75,near:1,far:1e4,position:[0,0,1e3],rotation:new m.Euler(0,0,0)},orthographic:!0,pixelRatio:g,invalidateFrameloop:!0,gl2:!0,onCreated:function(e){return function(e,t,a){S.set(e,{ctx:t,containerRef:a})}("embeddings",e,M)}},r.a.createElement(F,{canvasContainerRef:M},"embeddings"===_&&r.a.createElement(ye,{id:"cellEmbeddings",datasetId:"cellEmbeddings",metadataDatasetId:"cellMetadata",goActivityDatasetId:"goActivity"}),"pathways"===_&&r.a.createElement(ue,{nodes:T,edges:[]})))),w&&r.a.createElement("div",{className:"loading"},r.a.createElement("div",{className:"lds-ripple"},r.a.createElement("div",null),r.a.createElement("div",null))))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(u.a,{store:K},r.a.createElement(xe,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[170,1,2]]]);
//# sourceMappingURL=main.7d7f4292.chunk.js.map